# 项目演进规划与分析 (Development Plan)

本文档基于我们对 `LogSentinel` 项目“工具化”目标的讨论，分析接下来的开发路径、技术选型以及待解决的关键问题。

## 1. 目标形态：桌面级日志分析工具

我们希望将当前分离的前后端包装成一个开箱即用的“小工具”。
**预期体验:** 用户运行一个脚本或程序，自动启动后端服务，并打开浏览器界面，所有配置都能自动保存。

---

## 2. 核心问题分析与解决方案

### 2.1 启动方式 (Launcher)
如何让用户“一键启动”？

*   **方案:** **Python 启动脚本 (`run_tool.py`)**
    *   **原因:** 简单、跨平台、易于编写逻辑。
    *   **工作流程:**
        1.  **环境检查:** 检查 `server` 可执行文件是否存在。
        2.  **启动后端:** 使用 `subprocess` 启动 C++ 后端 (监听 8080)。
        3.  **启动前端:**
            *   *开发时:* 启动 `npm run dev`。
            *   *发布时:* 启动一个轻量级 Python HTTP Server (监听 3000) 指向 `client/dist` 目录。
        4.  **打开浏览器:** 自动调用系统默认浏览器打开 `http://localhost:3000`。
    *   **优点:** 彻底解耦了 C++ 和静态文件服务的复杂性，不需要修改 C++ 代码去 serve 静态文件（虽然那样性能更好，但开发成本高）。

### 2.2 配置持久化 (Settings Persistence)
目前前端刷新页面配置即丢失（API Key, Webhook URL 等）。

*   **现状:**
    *   后端已有 `SqliteConfigRepository` 类，支持 `webhook_configs` 表。
    *   后端 **缺失** 通用的 Key-Value 设置表（用于存 AI Key, 语言首选项等）。
    *   后端 **缺失** 前端可调用的 `/api/settings` 接口。
*   **解决方案:**
    1.  **数据库变更:** 在 SQLite 中新增 `app_settings` 表 (字段: `setting_key`, `setting_value`)。
    2.  **后端接口:** 开发 `SettingsHandler`，提供 GET 和 POST 接口。
    3.  **前端对接:** Store 初始化时调用 GET，修改配置时调用 POST。

### 2.3 实时通信：轮询 vs WebSocket
前端目前每秒轮询一次 (`setInterval` -> `fetch`)。

*   **分析:**
    *   **轮询 (Polling):** 实现极其简单，容错率高（断网了一会儿自动重连），对于 Dashboard 这种 1秒刷新一次的频率完全可接受。
    *   **WebSocket:** 延迟更低，服务器主动推送，更“专业”。但需要引入新的库（如 `uWebSockets` 或手写 Muduo 的 WS 协议处理），且需要处理心跳、重连、状态同步等复杂逻辑。
*   **建议:** **初期维持轮询**。
    *   目前的瓶颈不在网络开销，而在功能完整性。
    *   每秒一次的 HTTP 请求在本地 (Localhost) 环境下消耗极低，用户无感知。
    *   等到功能完善后，再考虑升级为 WebSocket。

---

## 3. 推荐的开发步骤 (Roadmap)

基于以上分析，建议接下来的开发顺序如下：

### 第一阶段：补全底层与持久化 (当前优先级最高)
**目标:** 让工具“可用”，配置能保存。
1.  **后端:** 修改 `SqliteConfigRepository`，增加通用设置存取功能。
2.  **后端:** 编写 `SettingsHandler` 并注册路由。
3.  **前端:** 移除 Mock 数据中的设置部分，改为从后端 API 加载。

### 第二阶段：封装启动器 (The Wrapper)
**目标:** 让工具“易用”，一键运行。
1.  **构建:** 编写 `run_tool.py`。
2.  **测试:** 确保关闭脚本时，后端进程也能被正确杀死 (Graceful Shutdown)。

### 第三阶段：功能增强
**目标:** 让工具“好用”。
1.  **日志详情页:** 优化日志展示，支持按 TraceID 搜索。
2.  **告警规则:** 在前端配置告警关键词，后端保存并生效。

---

## 4. 总结

您不需要立即重写代码，建议先按照 **第一阶段 (持久化)** 开始入手。因为如果没有配置保存功能，每次启动工具都要重新输入 API Key，用户体验会非常差。
